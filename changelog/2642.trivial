Refactored internal Python 2/3 compatibility code to use ``six``.
